<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../layout/layout.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-input/iron-input.html">
<link rel="import" href="../iron-selector/iron-selector.html">
<link rel="import" href="../neon-animation/neon-animation.html">
<link rel="import" href="../paper-input/paper-input-container.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-styles/paper-styles.html">
<link rel="import" href="../paper-menu/paper-menu.html">


<dom-module id="paper-dropdown-select">

  <style>
    #dropdown {
      max-height: var(--paper-dropdown-height, 500px);
      position: absolute;
      right: 0;
      background-color: var(--paper-dropdown-color, white);
      z-index: 1;
      display: none;
      white-space: nowrap;

      @apply(--shadow-elevation-2dp);
    }

    paper-menu::content paper-item {
      @apply(--paper-dropdown-select-items);
    }

    #dropdown-icon {
      cursor: pointer;
    }

    .iron-selected {
      font-weight: bold;
    }

    paper-item:hover {
      background-color: var(--paper-dropdown-highlight-color, #EBF0F3);
    }

    paper-item {
      cursor: pointer;
    }
  </style>

  <template>
    <div style="position:relative;">
      <div class="horizontal center layout" on-click="_dropdownAction">
        <span hidden$="{{hideLabel}}">{{selected}}</span>
        <iron-icon id="dropdown-icon" icon="[[_dropdownIcon(_open, icon)]]"></iron-icon>
      </div>
      <paper-menu id="dropdown" attr-for-selected="{{attrForSelected}}" selected="{{selected}}">
        <content></content>
      </paper-menu>
    </div>

  </template>

</dom-module>

<script>

  (function() {

    Polymer({

      is: 'paper-dropdown-select',

      behaviors: [
        Polymer.IronSelectableBehavior,
        Polymer.NeonAnimationRunnerBehavior
      ],

      properties: {
        disabled: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },
        name: String,
        attrForSelected: String,
        selected: {
          type: String,
          observer: '_selectedChanged',
          notify: true
        },
        _open: {
          type: Boolean,
          value: false
        },
        icon: {
          type: String,
          value: null
        },
        hideLabel: {
          type: Boolean,
          value: false
        },
        animationConfig: {
          type: Object,
          value: function() {
            return {
              'open': [{
                name: 'scale-up-animation',
                node: this.$$('#dropdown'),
                transformOrigin: '0 0'
              }],
              'close': [{
                'name': 'scale-down-animation',
                node: this.$$('#dropdown'),
                transformOrigin: '0 0'
              }]
            }
          }
        }
      },
      listeners: {
        'tap': '_updateSelected',
        'neon-animation-finish': '_displayNone'
      },
      _displayNone: function() {
        if (!this._open) {
          this.$$('#dropdown').style.display = 'none';
        }
      },

      _dropdownIcon: function(isOpen, icon) {
        if (icon) {
          return icon;
        } else if(isOpen) {
          return 'arrow-drop-up';
        } else {
          return 'arrow-drop-down';
        }
      },

      _dropdownAction: function(e) {
        if(this._open) {
          this._open = false;
          this.playAnimation('close');
        } else {
          this._open = true;
          this.$$('#dropdown').style.display = 'block';
          this.playAnimation('open');
        }
      },

      _hideDropdown : function() {
        this._open = false;
        this.playAnimation('close');
      },

      _selectedChanged: function (newVal) {
        this._hideDropdown();
      }
    });

  })();

</script>
