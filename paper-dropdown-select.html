<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../layout/layout.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-input/iron-input.html">
<link rel="import" href="../neon-animation/neon-animation.html">
<link rel="import" href="../paper-input/paper-input-container.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-styles/paper-styles.html">


<dom-module id="paper-dropdown-select">

  <style>
    .container {
      position: relative;
    }
    #dropdown {
      max-height: var(--paper-dropdown-height, 500px);
      position: absolute;
      right: 0;
      background-color: var(--paper-dropdown-color, white);
      z-index: 1;
      display: none;
      white-space: nowrap;

      @apply(--shadow-elevation-2dp);
    }

    #dropdown ::content paper-item {
      @apply(--paper-dropdown-select-items);
    }

    #dropdown-icon {
      cursor: pointer;
    }

    .iron-selected {
      font-weight: bold;
    }

    paper-item:hover {
      background-color: var(--paper-dropdown-highlight-color, #EBF0F3);
    }

    paper-item {
      cursor: pointer;
    }
  </style>

  <template>
    <div class="container" on-click="_dropdownAction">
      <div class="horizontal center layout">
        <span hidden$="{{!label}}">{{label}}</span>
        <iron-icon id="dropdown-icon" icon="[[_dropdownIcon(opened, icon)]]" hidden$="{{hideIcon}}"></iron-icon>
      </div>
      <div id="dropdown">
        <content select="paper-menu"></content>
      </div>
    </div>
  </template>

</dom-module>

<script>

  (function() {

    Polymer({

      is: 'paper-dropdown-select',

      behaviors: [
        Polymer.NeonAnimationRunnerBehavior
      ],

      properties: {
        disabled: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },
        name: String,
        attrForSelected: String,
        selected: {
          type: String,
          observer: '_selectedChanged',
          notify: true
        },
        opened: {
          type: Boolean,
          value: false,
          notify: true
        },
        label: {
          type: String,
          value: null
        },
        icon: {
          type: String,
          value: null
        },
        hideIcon: {
          type: Boolean,
          value: false
        },
        animationConfig: {
          type: Object,
          value: function() {
            return {
              'open': [{
                name: 'scale-up-animation',
                node: this.$$('#dropdown'),
                transformOrigin: '0 0'
              }],
              'close': [{
                'name': 'scale-down-animation',
                node: this.$$('#dropdown'),
                transformOrigin: '0 0'
              }]
            }
          }
        }
      },

      listeners: {
        'neon-animation-finish': '_displayNone'
      },

      open: function() {
        this._open();
      },

      close: function() {
        this._close();
      },

      _displayNone: function() {
        if (!this.opened) {
          this.$$('#dropdown').style.display = 'none';
        }
      },

      _dropdownIcon: function(isOpen, icon) {
        if (icon) {
          return icon;
        } else if(isOpen) {
          return 'arrow-drop-up';
        } else {
          return 'arrow-drop-down';
        }
      },

      _open: function() {
        this.opened = true;
        this.$$('#dropdown').style.display = 'block';
        this.playAnimation('open');
      },

      _close: function() {
        this.opened = false;
        this.playAnimation('close');
      },

      _dropdownAction: function(e) {
        if(this.opened) {
          this._close();
        } else {
          this._open();
        }
      },

      _hideDropdown : function() {
        this.opened = false;
        this.playAnimation('close');
      },

      _selectedChanged: function (newVal) {
        this._hideDropdown();
      }
    });

  })();

</script>
